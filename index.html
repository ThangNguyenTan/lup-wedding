<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Love Ticket ‚Äì T√†i & Nhi</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ---------------------------------------
     BASE RESET + GLOBAL
  --------------------------------------- */
      :root {
        --pink: #e91e63;
        --pink-light: #fff0f5;
        --btn-pink: #ff77a9;

        --radius: 14px;
        --page-pad: 16px;
        --page-gap: 20px;
        --max-width: 480px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Quicksand", sans-serif;
        background: var(--pink-light);
        display: flex;
        justify-content: center;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* ---------------------------------------
     PAGE
  --------------------------------------- */
      .page {
        width: 100%;
        max-width: var(--max-width);
        padding: var(--page-pad);

        /* Center content vertically */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* <-- CENTER CONTENT */

        gap: var(--page-gap);

        position: absolute;
        inset: 0;

        min-height: 100vh;
        overflow-y: auto;

        background: var(--pink-light);
        transition: opacity 0.35s ease;
        text-align: center;
      }

      .hidden {
        opacity: 0;
        pointer-events: none;
      }

      /* ---------------------------------------
     TYPOGRAPHY
  --------------------------------------- */
      h2 {
        font-family: "Dancing Script", cursive;
        font-size: clamp(26px, 7vw, 36px);
        color: var(--pink);
      }

      p {
        font-size: clamp(14px, 4vw, 18px);
        color: #444;
      }

      /* ---------------------------------------
     BUTTONS
  --------------------------------------- */
      button {
        padding: 12px 22px;
        background: var(--btn-pink);
        color: white;
        border-radius: 22px;
        font-size: clamp(14px, 4vw, 17px);
        border: none;
        cursor: pointer;
        transition: 0.2s ease;
      }

      button:active {
        transform: scale(0.93);
      }

      /* ---------------------------------------
     INPUTS
  --------------------------------------- */
      input {
        padding: 12px;
        font-size: clamp(14px, 4vw, 16px);
        border-radius: var(--radius);
        border: 1px solid #ddd;
        width: 90%;
        max-width: 330px;
        text-align: center;
      }

      /* ---------------------------------------
     IMAGES
  --------------------------------------- */
      img {
        width: 100%;
        max-width: 320px;
        border-radius: var(--radius);
        object-fit: cover;
      }

      /* ---------------------------------------
     CONCEPT BUTTONS
  --------------------------------------- */
      .concepts {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 12px;
        margin-top: 8px;
      }

      .concept {
        width: 75px;
        height: 75px;
        border-radius: 50%;
        background: #ffd6e3;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: clamp(11px, 3vw, 13px);
        cursor: pointer;
        padding: 10px;
        transition: 0.2s ease;
      }

      .concept:hover {
        transform: scale(1.05);
      }

      #welcomePage {
        display: block !important;
        justify-content: flex-start; /* content starts at top */
        padding-top: 24vh; /* keep spacing */
        padding-bottom: 12vh;
      }

      /* Couple row container */
      .couple-row {
        display: flex;
        justify-content: center;
        align-items: center; /* same vertical alignment */
        gap: 30px;
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        padding-top: 20px;
        margin-bottom: 30px;
      }

      /* Groom + Bride blocks */
      .couple-row .person {
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow: hidden;
      }

      /* Circle images */
      .couple-row img {
        width: 140px;
        height: 140px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #ffd6e3;
      }

      /* Labels */
      .couple-row p {
        margin-top: 8px;
        color: #e91e63;
        font-weight: 600;
      }

      /* Heart in the center */
      .heart-mid {
        font-size: 20px;
        color: #e91e63;
        transform: translateY(-10px);
      }

      /* ---------------------------------------
     ALBUM GRID
     - Mobile: 1 per row
     - Tablet: 2 per row
     - Desktop: 3 per row
  --------------------------------------- */
      #albumPage {
        justify-content: flex-start; /* content starts at top */
        padding-top: 12vh; /* keep spacing */
        padding-bottom: 12vh;
      }

      .album-grid {
        width: 100%;
        max-width: 900px; /* keeps grid centered on wide screens */
        margin: 0 auto; /* <-- CENTER THE GRID */
        display: grid;
        gap: 10px;
        padding-bottom: 40px;
        grid-template-columns: 1fr; /* mobile: 1 per row */
        justify-items: center; /* <-- center each cell */
      }

      /* Tablet */
      @media (min-width: 600px) {
        .album-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* Desktop */
      @media (min-width: 900px) {
        .album-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      /* Ensure images don't stretch weirdly */
      .album-grid img {
        width: 100%;
        aspect-ratio: 3/4;
        border-radius: 14px;
        object-fit: cover;
      }

      #groomImg {
        object-position: 45% 10%;
      }

      #brideImg {
        object-position: 55% 5%;
      }

      /* ---------------------------------------
     HEART DIVIDER
  --------------------------------------- */
      .heart-divider {
        font-size: 30px;
        margin: -10px 0 0 0;
      }

      .curious-text {
        margin-top: 15px;
        font-size: 16px;
        color: #e91e63;
      }

      .fake-no {
        margin-top: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        font-size: 17px;
        color: #ff4081;
        font-weight: 600;
      }

      .fake-no:hover {
        transform: scale(1.05);
      }

      /* Twist popup box */
      .twist-box {
        background: white;
        padding: 20px;
        border-radius: 14px;
        max-width: 90%;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        animation: popIn 0.4s ease-out;
      }

      .twist-box p {
        margin-top: 10px;
        font-size: 0.9rem;
      }

      /* Pop animation */
      @keyframes popIn {
        0% {
          transform: scale(0.6);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Simple fireworks */
      /* Fireworks overlay fills the page */
      #fireworks {
        position: absolute;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
      }

      /* Central flash of a firework */
      .flash {
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: white;
        opacity: 0;
        animation: flash-pop 350ms ease-out forwards;
      }

      @keyframes flash-pop {
        0% {
          transform: scale(0.3);
          opacity: 1;
          box-shadow: 0 0 20px 10px rgba(255, 255, 255, 0.9);
        }
        100% {
          transform: scale(2.8);
          opacity: 0;
        }
      }

      /* Individual sparks */
      .spark {
        position: absolute;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        opacity: 0;
        animation: spark-move 900ms ease-out forwards,
          spark-flicker 300ms ease-in-out infinite;
        box-shadow: 0 0 6px 3px rgba(255, 255, 255, 0.6);
      }

      /* Move outwards using CSS variables --dx / --dy */
      @keyframes spark-move {
        0% {
          transform: translate(0, 0) scale(0.4);
          opacity: 1;
        }
        70% {
          opacity: 1;
        }
        100% {
          transform: translate(var(--dx), var(--dy)) scale(0);
          opacity: 0;
        }
      }

      @keyframes spark-flicker {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.4;
        }
      }
    </style>
  </head>
  <body>
    <!-- PAGE 1 -->
    <div id="namePage" class="page">
      <h2>C·ªêC C·ªêC C·ªêC</h2>
      <h2>Ai g·ªçi ƒë√≥?</h2>
      <input id="guestName" placeholder="T√¥i l√† ..." />
      <button onclick="goTo('welcomePage')">Ti·∫øp t·ª•c</button>
    </div>

    <!-- PAGE 2 -->
    <div id="welcomePage" class="page hidden">
      <h2>Ch√†o M·ª´ng B·∫°n ƒê·∫øn V·ªõi</h2>
      <h2>Nh·ªØng Kho·∫£nh Kh·∫Øc ƒê√°ng Nh·ªõ c·ªßa</h2>
      <div class="couple-row">
        <div class="person">
          <img id="brideImg" />
          <p>C√¥ d√¢u: Tuy·∫øt Nhi</p>
        </div>

        <div class="person">
          <img id="groomImg" />
          <p>Ch√∫ r·ªÉ: Anh T√†i</p>
        </div>
      </div>
      <button onclick="goTo('videoPage')">Ti·∫øp t·ª•c</button>
    </div>

    <!-- PAGE 3 -->
    <div id="videoPage" class="page hidden">
      <h2>Video k·ª∑ ni·ªám üé•</h2>
      <iframe
        width="360"
        height="220"
        src="https://drive.google.com/file/d/15-0Ezk9wrdoMYES7ZcdPCIMbilMxqhaw/preview"
        allow="autoplay"
      ></iframe>
      <button onclick="goTo('albumPage')">Xem Album</button>
    </div>

    <!-- PAGE 4 -->
    <div id="albumPage" class="page hidden">
      <h2>Album c∆∞·ªõi üíï</h2>
      <div class="concepts" id="conceptList"></div>
      <div class="album-grid" id="albumContainer"></div>
      <button onclick="goTo('rsvpPage')">Ti·∫øp t·ª•c</button>
    </div>

    <!-- RSVP -->
    <div id="rsvpPage" class="page hidden">
      <h2>03/01/2026 ‚Äì Ng√†y vui c·ªßa t·ª•i m√¨nh üíí</h2>
      <p>B·∫°n c√≥ ƒë·∫øn chung vui v·ªõi t·ª•i m√¨nh kh√¥ng?</p>
      <button onclick="goTo('rsvpYes')">YES</button>
      <button onclick="goTo('rsvpNo')">NO</button>
    </div>

    <div id="rsvpYes" class="page hidden">
      <h2>Y√™u b·∫°n nhi·ªÅu!</h2>
      <p>T·ª•i m√¨nh r·∫•t mong b·∫°n ƒë·∫øn nha ‚ù§Ô∏è</p>

      <p class="curious-text">B·∫°n c√≥ t√≤ m√≤ n·∫øu ch·ªçn NO s·∫Ω nh∆∞ th·∫ø n√†o kh√¥ng?</p>

      <div class="fake-no" onclick="triggerFakeNo()">
        <span>üëâ</span> <span class="fake-no-text">B·∫•m th·ª≠ ƒëi</span>
      </div>
    </div>

    <div id="rsvpNo" class="page hidden">
      <h2>NO h·∫£ üò≥</h2>

      <!-- This will show after NO runs away 3 times -->
      <p
        id="noFinalMessage"
        style="display: none; font-size: 18px; color: #e91e63"
      >
        Ph·∫£i b·∫•m "YES" m·ªõi ƒë∆∞·ª£c üòÜ
      </p>

      <!-- The new YES button (hidden until needed) -->
      <button id="noToYesBtn" style="display: none" onclick="gotoNoYes()">
        YES üòÜ
      </button>

      <!-- The running NO button -->
      <button id="noRunBtn" onclick="noClicked()">NO üò≠</button>
    </div>

    <div id="noResultPage" class="page hidden">
      <h2>√íaaa...</h2>

      <p>Ahihi, m·ªôt ch√∫t tr√≤ ch∆°i nh·ªè ƒë·ªÉ vui v·∫ª n√®.</p>
      <p>C·ªë g·∫Øng s·∫Øp x·∫øp ƒë·∫øn chung vui v·ªõi t·ª•i m√¨nh nh√©.!</p>
      <p>Xin c·∫£m ∆°n!</p>
      <p>B·∫°n th·∫≠t l√† d·ªÖ th∆∞∆°ng!</p>

      <button>H·∫øt g√≤i ‚ù§Ô∏è</button>
    </div>

    <div id="rsvpThanks" class="page hidden">
      <h2>C·∫£m ∆°n b·∫°n!</h2>
      <p>Th·∫≠t d·ªÖ th∆∞∆°ng khi b·∫°n xem t·ªõi cu·ªëi ü•∞</p>
    </div>

    <div id="twistPage" class="page hidden">
      <div class="twist-box">
        <h2>CH√öC M·ª™NG B·∫†N ƒê√É NH·∫¨N ƒê∆Ø·ª¢C</h2>
        <h2>M·ªòT N·ª§ C∆Ø·ªúI üòÉ</h2>
        <p>1 n·ª• c∆∞·ªùi b·∫±ng 10 thang thu·ªëc b·ªï ƒë√≥! üòâ</p>
      </div>

      <!-- Fireworks container -->
      <div id="fireworks"></div>

      <p style="margin-top: 20px; font-size: 14px; color: #e91e63">
        Ch·∫°m v√†o m√†n h√¨nh ƒë·ªÉ ti·∫øp t·ª•c
      </p>
    </div>

    <!-- GOOGLE API -->
    <script src="https://apis.google.com/js/api.js"></script>

    <script>
      /* ----------------------------------------
      PAGE SWITCH
---------------------------------------- */
      function goTo(id) {
        document.querySelectorAll(".page").forEach((p) => {
          p.classList.add("hidden");
          p.scrollTop = 0; // <-- reset scroll each time
        });

        const target = document.getElementById(id);
        target.classList.remove("hidden");

        target.scrollTop = 0; // <-- ensure the shown page starts at top

        // Reset NO logic when entering rsvpNo page
        if (id === "rsvpNo") {
          noRunCount = 0;

          const btn = document.getElementById("noRunBtn");
          const msg = document.getElementById("noFinalMessage");
          const yesBtn = document.getElementById("noToYesBtn");

          btn.style.transform = "none";
          btn.style.display = "inline-block";

          msg.style.display = "none";
          yesBtn.style.display = "none";
        }

        if (id === "albumPage") {
          loadAlbum("Nh√† Th·ªù");
        }
      }

      /* ----------------------------------------
      CONFIG ‚Äî üî• REPLACE THESE
---------------------------------------- */
      const CONFIG = {
        apiKey: "AIzaSyAw1gQSH2ldNO0mKUtPLMebZ9c7cULkl70",

        groomImg: "1sB3Yry1z2po-ZoUUypm06MWRlG6UHjiU",
        brideImg: "14WlBe-yxXgL67M2uOsfr7Paho3Hr2PLq",

        folders: {
          "Nh√† Th·ªù": "1RTScn1xIh4VFN15r-UQ3deT3jr6wV1Fy",
          "ƒê·ªì H·ª∑": "1Q-W-ZlBsWMjgGtlrWicrj3I6PghJuEBe",
          "S∆∞·ªùn X√°m": "19xeTVfUbV0sPVgUfu31-Rwwym-SXRvLC",
          Bi·ªÉn: "1ZUzPS2XyLy65f1V-EsuIWwfng7z7FYJV",
        },
      };

      /* ----------------------------------------
      START GOOGLE DRIVE API (NO LOGIN)
---------------------------------------- */
      gapi.load("client", initGapi);

      async function initGapi() {
        console.log("gapi loaded");

        // Step 1: Initialize base client
        await gapi.client.init({
          apiKey: CONFIG.apiKey,
          discoveryDocs: [
            "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",
          ],
        });

        console.log("client initialized");

        // Step 2: Load the actual Drive API
        await gapi.client.load("drive", "v3");

        console.log("drive api loaded");

        // Step 3 (IMPORTANT): Now it's safe to call Drive API
        window.driveReady = true;
      }

      /* ----------------------------------------
      LOAD BRIDE & GROOM PHOTOS
---------------------------------------- */
      document.getElementById(
        "groomImg"
      ).src = `https://lh3.googleusercontent.com/d/${CONFIG.groomImg}`;

      document.getElementById(
        "brideImg"
      ).src = `https://lh3.googleusercontent.com/d/${CONFIG.brideImg}`;

      /* ----------------------------------------
      LOAD CONCEPT BUTTONS
---------------------------------------- */
      const conceptList = document.getElementById("conceptList");
      for (let name in CONFIG.folders) {
        const div = document.createElement("div");
        div.className = "concept";
        div.innerText = name;
        div.onclick = () => loadAlbum(name);
        conceptList.appendChild(div);
      }

      /* ----------------------------------------
      AUTO-LOAD ALBUM FROM PUBLIC FOLDER
---------------------------------------- */
      async function loadAlbum(conceptName) {
        const folderId = CONFIG.folders[conceptName];
        const container = document.getElementById("albumContainer");
        container.innerHTML = "ƒêang t·∫£i ·∫£nh...";

        const query = `'${folderId}' in parents and mimeType contains 'image/' and trashed = false`;
        const encodedQuery = encodeURIComponent(query);

        const url = `https://www.googleapis.com/drive/v3/files?q=${encodedQuery}&fields=files(id,name)&key=${CONFIG.apiKey}`;

        try {
          const res = await fetch(url);
          const data = await res.json();

          const files = data.files || [];

          container.innerHTML = "";

          if (files.length === 0) {
            container.innerHTML =
              "<p>Ch∆∞a c√≥ ·∫£nh trong th∆∞ m·ª•c n√†y ho·∫∑c API ch∆∞a fetch ƒë∆∞·ª£c ·∫£nh.</p>";
            return;
          }

          files.forEach((file) => {
            const img = document.createElement("img");
            img.src = `https://lh3.googleusercontent.com/d/${file.id}`;
            img.loading = "lazy";
            container.appendChild(img);
          });
        } catch (error) {
          console.error("Drive API error:", error);
          container.innerHTML = "<p>L·ªói khi t·∫£i ·∫£nh.</p>";
        }
      }

      function triggerFakeNo() {
        // Go to the NO page
        goTo("rsvpNo");

        // Simulate the NO button running 3 times (same behavior as the first NO)
        const noButton = document.querySelector("#rsvpNo button");

        let count = 0;

        function runAway() {
          if (count >= 3) return;

          // random movement (same effect as first NO)
          const x = Math.random() * 140 - 70;
          const y = Math.random() * 100 - 50;

          noButton.style.transform = `translate(${x}px, ${y}px)`;
          count++;

          // do again in 600ms
          setTimeout(runAway, 600);
        }

        runAway(); // start animation
      }

      let noRunCount = 0;

      function noClicked() {
        const btn = document.getElementById("noRunBtn");
        const msg = document.getElementById("noFinalMessage");
        const yesBtn = document.getElementById("noToYesBtn");

        if (noRunCount < 3) {
          // Run away NO button
          const x = Math.random() * 150 - 75;
          const y = Math.random() * 120 - 60;
          btn.style.transform = `translate(${x}px, ${y}px)`;

          noRunCount++;
        } else {
          // After 3 runs ‚Üí show message + YES button
          btn.style.display = "none";
          msg.style.display = "block";
          yesBtn.style.display = "inline-block";
        }
      }

      function gotoNoYes() {
        goTo("twistPage");
        launchFireworks();
      }

      function launchFireworks() {
        const container = document.getElementById("fireworks");
        if (!container) return;

        container.innerHTML = ""; // clear previous

        // Launch 3 fireworks in sequence
        for (let i = 0; i < 100; i++) {
          setTimeout(() => createFirework(container), i * 450);
        }
      }

      function createFirework(container) {
        const rect = container.getBoundingClientRect();

        // Pick a point roughly in the upper-middle area of the page
        const cx = rect.width * (0.3 + Math.random() * 0.4); // 30‚Äì70% width
        const cy = rect.height * (0.2 + Math.random() * 0.3); // 20‚Äì50% height

        // Create central flash
        const flash = document.createElement("div");
        flash.className = "flash";
        flash.style.left = cx + "px";
        flash.style.top = cy + "px";
        container.appendChild(flash);
        setTimeout(() => flash.remove(), 400);

        // Create sparks
        const sparkCount = 12 + Math.floor(Math.random() * 8);
        const colors = ["#ff4d6d", "#ff9f1c", "#ffe066", "#70d6ff", "#c77dff"];

        for (let i = 0; i < sparkCount; i++) {
          const spark = document.createElement("div");
          spark.className = "spark";

          const angle = Math.random() * 2 * Math.PI;
          const distance = 70 + Math.random() * 80; // explosion radius

          const dx = Math.cos(angle) * distance;
          const dy = Math.sin(angle) * distance;

          spark.style.setProperty("--dx", dx + "px");
          spark.style.setProperty("--dy", dy + "px");

          spark.style.left = cx + "px";
          spark.style.top = cy + "px";

          const color = colors[Math.floor(Math.random() * colors.length)];
          spark.style.background = color;
          spark.style.boxShadow = `0 0 8px 4px ${color}77`;

          container.appendChild(spark);

          setTimeout(() => spark.remove(), 950);
        }
      }

      document.getElementById("twistPage").addEventListener("click", () => {
        goTo("noResultPage");
      });
    </script>
  </body>
</html>
